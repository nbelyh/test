<!DOCTYPE html>
<html class="vp">
<head>
<title>Drawing1</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script src="vp/jquery-3.1.1.min.js"></script>
<link href="vp/bootstrap-3.3.7.min.css" rel="stylesheet"/>
<script src="vp/bootstrap-3.3.7.min.js"></script>


<link href="vp/vp-style-1.1.1.min.css" rel="stylesheet" />
    <script>
        window.svgpublish = {"shapes":{"shape1":{"Layers":[],"Text":"AAA"},"shape2":{"Layers":[],"Text":"BBB"},"shape3":{"Layers":[],"Text":"CCC"},"shape4":{"Layers":[],"Text":"DDD"},"shape5":{"Layers":[],"Text":"EEE"},"shape6":{"Layers":[],"Text":"FFF"}},"pages":[{"Name":"Page-1","Id":0}],"currentPage":{"Name":"Page-1","Id":0},"layers":[],"enableProps":false,"enableLinks":false,"enablePages":false,"enableSearch":false,"enableCode":true,"enableSidebar":true,"enableTooltips":false,"enableSelection":false,"enableLayers":false,"enableFollowHyperlinks":false,"openHyperlinksInNewWindow":false}
    </script>
<script src="vp/vp-script-1.1.1.min.js"></script>
</head>
<body>

<div id="diagram-sidebar" style="display: none; position: absolute">
    <div style="height: 100%; width: 100%; padding: 1em">
        <div id="shape-code" class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                        <svg class="icon-sidebar">
                            <symbol id="icon-list-ul" viewBox="0 0 28 28">
                                <path d="M6 22c0 1.656-1.344 3-3 3s-3-1.344-3-3 1.344-3 3-3 3 1.344 3 3zM6 14c0 1.656-1.344 3-3 3s-3-1.344-3-3 1.344-3 3-3 3 1.344 3 3zM28 20.5v3c0 0.266-0.234 0.5-0.5 0.5h-19c-0.266 0-0.5-0.234-0.5-0.5v-3c0-0.266 0.234-0.5 0.5-0.5h19c0.266 0 0.5 0.234 0.5 0.5zM6 6c0 1.656-1.344 3-3 3s-3-1.344-3-3 1.344-3 3-3 3 1.344 3 3zM28 12.5v3c0 0.266-0.234 0.5-0.5 0.5h-19c-0.266 0-0.5-0.234-0.5-0.5v-3c0-0.266 0.234-0.5 0.5-0.5h19c0.266 0 0.5 0.234 0.5 0.5zM28 4.5v3c0 0.266-0.234 0.5-0.5 0.5h-19c-0.266 0-0.5-0.234-0.5-0.5v-3c0-0.266 0.234-0.5 0.5-0.5h19c0.266 0 0.5 0.234 0.5 0.5z"></path>
                            </symbol>
                            <use xlink:href="#icon-list-ul"></use>
                    </svg>&nbsp;
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseCode">Code Editor</a>
                </h4>
            </div>
            <div id="collapseCode" class="panel-collapse collapse in">
                <div id="panel-code" class="panel-body">
                    <div style="display: flex; flex-direction: column; overflow: hidden; height: 80vh; width: 100%">
                        <div style="margin: 10px">
                            <input type="button" class="btn btn-default" value="Run" onclick="onRun()" />
                        </div>
                        <div id="container" style="border: 1px solid grey; flex: 1"></div>

                        <script src="https://unpkg.com/monaco-editor@0.8.3/min/vs/loader.js"></script>
                        <script>
                            require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor@0.8.3/min/vs' } });
                            window.MonacoEnvironment = { getWorkerUrl: () => proxy };

                            var proxy = URL.createObjectURL(
                                new Blob([
                                        "self.MonacoEnvironment = { baseUrl: 'https://unpkg.com/monaco-editor@0.8.3/min/' }; importScripts('https://unpkg.com/monaco-editor@0.8.3/min/vs/base/worker/workerMain.js');"
                                    ], { type: 'text/javascript' }));

                            require(["vs/editor/editor.main"],
                                function() {
                                    $.get("https://raw.githubusercontent.com/nbelyh/svgpublish-templates/master/Visio.d.ts", function(d) {
                                        monaco.languages.typescript.javascriptDefaults.addExtraLib(d, "diagram.d.ts");
                                    });
                                    window.editor = monaco.editor.create(document.getElementById('container'),
                                        {
                                            value: [
                                                'Visio.run(function(ctx) {',
                                                '\tvar doc = ctx.document;',
                                                '})'
                                            ].join('\n'),
                                            language: 'javascript'
                                        });
                                });

                            function onRun() {
                                if (window.editor)
                                    eval(window.editor.getValue());
                            }
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
    
<div id="sidebar-toggle" style="display: none">
    <svg class="icon-sidebar">
        <symbol id="icon-bars" viewBox="0 0 24 28">
            <path d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0 0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z"></path>
        </symbol>
        <use xlink:href="#icon-bars"></use>
    </svg>
</div>
<div id='iframeHost' style="width: 100%; height: 100%" />
<script src='https://visioonlineapi.azurewebsites.net/visio.js' type='text/javascript'></script>
<script language="javascript">

    var url = 'https://unmanagedvisio.sharepoint.com//_layouts/15/WopiFrame2.aspx?sourcedoc=https://unmanagedvisio.sharepoint.com/Shared Documents/Rect.vsd&action=embedView';

    // Loads the Visio application and Initializes communication between devloper frame and Visio online frame
    var session = new OfficeExtension.EmbeddedSession(url,
        {
            id: "embed-iframe",
            container: document.getElementById("iframeHost"),
            width: "100%",
            height: "99%"
        });

    session.init().then(function () {
        // Initilization is successful 
        OfficeExtension.ClientRequestContext._overrideSession = session;
    });
</script>
<svg style="position: absolute; width: 0; height: 0; overflow: hidden;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
        <filter id="hover">
            <feMorphology result="offset" in="SourceGraphic" operator="dilate" radius="5"></feMorphology>
            <feColorMatrix result="drop" in="offset" type="matrix" values="1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0.3 0"></feColorMatrix>
            <feBlend in="SourceGraphic" in2="drop" mode="normal"></feBlend>
        </filter>

        <filter id="select">
            <feMorphology result="offset" in="SourceGraphic" operator="dilate" radius="5"></feMorphology>
            <feColorMatrix result="drop" in="offset" type="matrix" values="1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0.9 0"></feColorMatrix>
            <feBlend in="SourceGraphic" in2="drop" mode="normal"></feBlend>
        </filter>
        <filter id="hyperlink">
            <feMorphology result="offset" in="SourceGraphic" operator="dilate" radius="5"></feMorphology>
            <feColorMatrix result="drop" in="offset" type="matrix" values="0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0.3 0"></feColorMatrix>
            <feBlend in="SourceGraphic" in2="drop" mode="normal"></feBlend>
        </filter>
    </defs>
</svg>

<script type="text/javascript">
    (function (diagram) {  })(window.svgpublish);
</script>
</body>
</html>